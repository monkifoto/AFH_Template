<form [formGroup]="form">
  <h2>Sections</h2>
  <button (click)="addSection()" class="afhBtn">+ Add Section</button>

  <div formArrayName="sections">
    <div *ngFor="let section of sections.controls; let i = index" [formGroupName]="i" class="sectionForm-container">
      <h3>Section {{ i + 1 }}</h3>

      <label>Component Type</label>
      <select formControlName="component" class="form-control">
        <option *ngFor="let type of componentTypes" [value]="type">{{ type }}</option>
      </select>
      <div class="row">
        <div class="col">
      <label>Order</label>
      <input type="number" formControlName="order" class="form-control" />
        </div>
        <div class="col">
      <label>Page</label>
      <select formControlName="page" class="form-control">
        <option *ngFor="let p of pages" [value]="p">{{ p }}</option>
      </select>
        </div>
        <div class="col">
      <label>Location</label>
      <select formControlName="location" class="form-control">
        <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
      </select>
        </div>
      </div>
      <div >
        <!-- ✅ Title Fields in One Row -->
        <div class="row">
          <div class="col">
            <label>Title</label>
            <input formControlName="sectionTitle" class="form-control" />
          </div>
          <div class="col">
            <label>Title Font Size</label>
            <input type="number" formControlName="titleFontSize" class="form-control" />
          </div>
          <div class="col">
            <label>Title Font Style</label>
            <select formControlName="titleFontStyle" class="form-control">
              <option *ngFor="let style of fontStyles" [value]="style">{{ style }}</option>
            </select>
          </div>
        </div>

        <!-- ✅ Subtitle Fields in One Row -->
        <div class="row">
          <div class="col">
            <label>Subtitle</label>
            <input formControlName="sectionSubTitle" class="form-control" />
          </div>
          <div class="col">
            <label>Subtitle Font Size</label>
            <input type="number" formControlName="subtitleFontSize" class="form-control" />
          </div>
          <div class="col">
            <label>Subtitle Font Style</label>
            <select formControlName="subtitleFontStyle" class="form-control">
              <option *ngFor="let style of fontStyles" [value]="style">{{ style }}</option>
            </select>
          </div>
        </div>
        <div *ngIf="section.get('component')?.value !== 'item-list' || section.get('component')?.value === 'icon-list'">
        <label>Content</label>
        <textarea formControlName="sectionContent" class="form-control"></textarea>

        <label>Image Upload</label>
        <input type="file" (change)="uploadImage($event, i)" />

        <!-- ✅ Upload Progress Tracking -->
        <div *ngIf="uploadProgress[i] as progress$">
          <div *ngIf="progress$ | async as progress">
            <div *ngIf="progress < 100">
              Uploading... {{ progress }}%
            </div>
          </div>
        </div>

        <!-- ✅ Image Preview with 100px Size -->
        <label>Image Preview</label>
        <img *ngIf="section.get('sectionImageUrl')?.value"
             [src]="section.get('sectionImageUrl')?.value"
             class="uploaded-image-preview" />

        <p>Image URL: {{ section.get('sectionImageUrl')?.value }}</p>

        <label>Show Learn More Button?</label>
        <input type="checkbox" formControlName="showLearnMore" />
      </div>
      </div>

      <!-- ✅ List-Item Section -->
      <div *ngIf="section.get('component')?.value === 'item-list' || section.get('component')?.value === 'icon-list' ">
        <h3>List Items</h3>
        <button (click)="addItem(i)" class="afhBtn">+ Add Item</button>

        <!-- <div formArrayName="items">
          <div *ngFor="let item of getItems(section)?.controls; let j = index" [formGroupName]="j">
            <input formControlName="title" class="form-control" placeholder="Title" />
            <input formControlName="description" class="form-control" placeholder="Description" />
            <input formControlName="icon" class="form-control" placeholder="Icon" />
            <button (click)="removeItem(i, j)">Remove</button>
          </div>
        </div> -->

        <div *ngIf="getItems(section) as items">
          <div formArrayName="items">
            <div *ngFor="let item of items.controls; let j = index" [formGroupName]="j">
              <input formControlName="title" class="form-control" placeholder="Title" />
              <input formControlName="description" class="form-control" placeholder="Description" />
              <input formControlName="icon" class="form-control" placeholder="Icon" />
              <button (click)="removeItem(i, j)">Remove</button>
            </div>
          </div>
        </div>
      </div>

      <button (click)="updateSection(i)">Update</button>
      <button (click)="removeSection(i)">Delete</button>
    </div>
  </div>
</form>
